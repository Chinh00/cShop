À
W/Users/bachviet/Documents/Personal/dotnet/cShop/src/Services/IdentityServer/SeedData.cs
	namespace 	
IdentityServer
 
; 
public 
class 
SeedData 
: 
IHostedService &
{		 
private

 
readonly

 
IServiceProvider

 %
_serviceProvider

& 6
;

6 7
public 

SeedData 
( 
IServiceProvider $
serviceProvider% 4
)4 5
{ 
_serviceProvider 
= 
serviceProvider *
;* +
} 
public 

async 
Task 

StartAsync  
(  !
CancellationToken! 2
cancellationToken3 D
)D E
{ 
using 
var 
scope 
= 
_serviceProvider *
.* +
CreateScope+ 6
(6 7
)7 8
;8 9
var  
dbContextUserManager  
=! "
scope# (
.( )
ServiceProvider) 8
.8 9
GetRequiredService9 K
<K L
UserManagerL W
<W X
UserX \
>\ ]
>] ^
(^ _
)_ `
;` a
var 
	dbContext 
= 
scope 
. 
ServiceProvider -
.- .
GetRequiredService. @
<@ A
UserDbContextA N
>N O
(O P
)P Q
;Q R
await 
	dbContext 
. 
Database  
.  !
MigrateAsync! -
(- .
cancellationToken. ?
)? @
;@ A
if 

( 
!  
dbContextUserManager !
.! "
Users" '
.' (
Any( +
(+ ,
), -
)- .
{ 	
for 
( 
var 
i 
= 
$num 
; 
i 
< 
$num  "
;" #
i$ %
++% '
)' (
{ 
await  
dbContextUserManager *
.* +
CreateAsync+ 6
(6 7
new7 :
User; ?
(? @
)@ A
{ 
UserName 
= 
$" !
$str! &
{& '
i' (
}( )
") *
,* +
Email   
=   
$str   -
,  - .
}!! 
,!! 
$str!! 
)!!  
;!!  !
}"" 
}## 	
}$$ 
public&& 

Task&& 
	StopAsync&& 
(&& 
CancellationToken&& +
cancellationToken&&, =
)&&= >
=>&&? A
Task&&B F
.&&F G
CompletedTask&&G T
;&&T U
}'' ú
V/Users/bachviet/Documents/Personal/dotnet/cShop/src/Services/IdentityServer/Program.cs
Log 
. 
Logger 

= 
new 
LoggerConfiguration $
($ %
)% &
.		 
WriteTo		 
.		 
Console		 
(		 
)		 
.

 !
CreateBootstrapLogger

 
(

 
)

 
;

 
Log 
. 
Information 
( 
$str 
) 
; 
try 
{ 
var 
builder 
= 
WebApplication  
.  !
CreateBuilder! .
(. /
args/ 3
)3 4
;4 5
builder 
. 
Host 
. 

UseSerilog 
( 
( 
ctx  
,  !
lc" $
)$ %
=>& (
lc) +
. 	
WriteTo	 
. 
Console 
( 
outputTemplate '
:' (
$str	) ã
)
ã å
. 	
Enrich	 
. 
FromLogContext 
( 
)  
. 	
ReadFrom	 
. 
Configuration 
(  
ctx  #
.# $
Configuration$ 1
)1 2
)2 3
;3 4
builder 
. 
Services 
. 
AddDbContext !
<! "
UserDbContext" /
>/ 0
(0 1
(1 2
provider2 :
,: ;
optionsBuilder< J
)J K
=>L N
{ 
optionsBuilder 
. 
UseSqlServer #
(# $
builder$ +
.+ ,
Configuration, 9
.9 :
GetConnectionString: M
(M N
$strN R
)R S
)S T
;T U
} 
) 
; 
builder   
.   
Services   
.!! 	
AddIdentity!!	 
<!! 
User!! 
,!! 
IdentityRole!! '
<!!' (
Guid!!( ,
>!!, -
>!!- .
(!!. /
)!!/ 0
."" 	$
AddEntityFrameworkStores""	 !
<""! "
UserDbContext""" /
>""/ 0
(""0 1
)""1 2
.## 	
AddUserManager##	 
<## 
UserManager## #
<### $
User##$ (
>##( )
>##) *
(##* +
)##+ ,
.$$ 	
AddSignInManager$$	 
<$$ 
SignInManager$$ '
<$$' (
User$$( ,
>$$, -
>$$- .
($$. /
)$$/ 0
.%% 	$
AddDefaultTokenProviders%%	 !
(%%! "
)%%" #
;%%# $
builder'' 
.'' 
Services'' 
.'' 
AddHostedService'' %
<''% &
SeedData''& .
>''. /
(''/ 0
)''0 1
;''1 2
var** 
app** 
=** 
builder** 
.++ 	
ConfigureServices++	 
(++ 
)++ 
.,, 	
ConfigurePipeline,,	 
(,, 
),, 
;,, 
app.. 
... 
Run.. 
(.. 
).. 
;.. 
}11 
catch22 
(22 
	Exception22 
ex22 
)22 
{33 
Log44 
.44 
Fatal44 
(44 
ex44 
,44 
$str44 '
)44' (
;44( )
}55 
finally66 
{77 
Log88 
.88 
Information88 
(88 
$str88 (
)88( )
;88) *
Log99 
.99 
CloseAndFlush99 
(99 
)99 
;99 
}:: Á
`/Users/bachviet/Documents/Personal/dotnet/cShop/src/Services/IdentityServer/HostingExtensions.cs
	namespace 	
IdentityServer
 
; 
internal 
static	 
class 
HostingExtensions '
{ 
public 

static 
WebApplication  
ConfigureServices! 2
(2 3
this3 7!
WebApplicationBuilder8 M
builderN U
)U V
{		 
builder 
. 
Services 
. 
AddIdentityServer *
(* +
options+ 2
=>3 5
{ 
options 
. #
EmitStaticAudienceClaim /
=0 1
true2 6
;6 7
} 
) 
. (
AddInMemoryIdentityResources )
() *
Config* 0
.0 1
IdentityResources1 B
)B C
.  
AddInMemoryApiScopes !
(! "
Config" (
.( )
	ApiScopes) 2
)2 3
. 
AddInMemoryClients 
(  
Config  &
.& '
Clients' .
). /
. 
AddAspNetIdentity 
< 
User #
># $
($ %
)% &
. 
AddProfileService 
<  
CustomProfileService 3
>3 4
(4 5
)5 6
. 
AddTestUsers 
( 
Config  
.  !
Users! &
.& '
ToList' -
(- .
). /
)/ 0
; 
return 
builder 
. 
Build 
( 
) 
; 
} 
public 

static 
WebApplication  
ConfigurePipeline! 2
(2 3
this3 7
WebApplication8 F
appG J
)J K
{ 
app 
. $
UseSerilogRequestLogging $
($ %
)% &
;& '
if!! 

(!! 
app!! 
.!! 
Environment!! 
.!! 
IsDevelopment!! )
(!!) *
)!!* +
)!!+ ,
{"" 	
app## 
.## %
UseDeveloperExceptionPage## )
(##) *
)##* +
;##+ ,
}$$ 	
app** 
.** 
UseIdentityServer** 
(** 
)** 
;**  
return00 
app00 
;00 
}11 
}22 ¥
a/Users/bachviet/Documents/Personal/dotnet/cShop/src/Services/IdentityServer/Data/UserDbContext.cs
	namespace 	
IdentityServer
 
. 
Data 
; 
public 
class 
UserDbContext 
( 
DbContextOptions +
<+ ,
UserDbContext, 9
>9 :
options; B
)B C
:D E
IdentityDbContextF W
<W X
UserX \
,\ ]
IdentityRole^ j
<j k
Guidk o
>o p
,p q
Guidr v
>v w
(w x
optionsx 
)	 Ä
{		 
} Ä∆
t/Users/bachviet/Documents/Personal/dotnet/cShop/src/Services/IdentityServer/Data/Migrations/20240923074619_InitDb.cs
	namespace 	
IdentityServer
 
. 
Data 
. 

Migrations (
{ 
public		 

partial		 
class		 
InitDb		 
:		  !
	Migration		" +
{

 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str #
,# $
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
Guid& *
>* +
(+ ,
type, 0
:0 1
$str2 D
,D E
nullableF N
:N O
falseP U
)U V
,V W
Name 
= 
table  
.  !
Column! '
<' (
string( .
>. /
(/ 0
type0 4
:4 5
$str6 E
,E F
	maxLengthG P
:P Q
$numR U
,U V
nullableW _
:_ `
truea e
)e f
,f g
NormalizedName "
=# $
table% *
.* +
Column+ 1
<1 2
string2 8
>8 9
(9 :
type: >
:> ?
$str@ O
,O P
	maxLengthQ Z
:Z [
$num\ _
,_ `
nullablea i
:i j
truek o
)o p
,p q
ConcurrencyStamp $
=% &
table' ,
., -
Column- 3
<3 4
string4 :
>: ;
(; <
type< @
:@ A
$strB Q
,Q R
nullableS [
:[ \
true] a
)a b
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% 5
,5 6
x7 8
=>9 ;
x< =
.= >
Id> @
)@ A
;A B
} 
) 
; 
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str #
,# $
columns 
: 
table 
=> !
new" %
{ 
Id   
=   
table   
.   
Column   %
<  % &
Guid  & *
>  * +
(  + ,
type  , 0
:  0 1
$str  2 D
,  D E
nullable  F N
:  N O
false  P U
)  U V
,  V W
UserName!! 
=!! 
table!! $
.!!$ %
Column!!% +
<!!+ ,
string!!, 2
>!!2 3
(!!3 4
type!!4 8
:!!8 9
$str!!: I
,!!I J
	maxLength!!K T
:!!T U
$num!!V Y
,!!Y Z
nullable!![ c
:!!c d
true!!e i
)!!i j
,!!j k
NormalizedUserName"" &
=""' (
table"") .
."". /
Column""/ 5
<""5 6
string""6 <
>""< =
(""= >
type""> B
:""B C
$str""D S
,""S T
	maxLength""U ^
:""^ _
$num""` c
,""c d
nullable""e m
:""m n
true""o s
)""s t
,""t u
Email## 
=## 
table## !
.##! "
Column##" (
<##( )
string##) /
>##/ 0
(##0 1
type##1 5
:##5 6
$str##7 F
,##F G
	maxLength##H Q
:##Q R
$num##S V
,##V W
nullable##X `
:##` a
true##b f
)##f g
,##g h
NormalizedEmail$$ #
=$$$ %
table$$& +
.$$+ ,
Column$$, 2
<$$2 3
string$$3 9
>$$9 :
($$: ;
type$$; ?
:$$? @
$str$$A P
,$$P Q
	maxLength$$R [
:$$[ \
$num$$] `
,$$` a
nullable$$b j
:$$j k
true$$l p
)$$p q
,$$q r
EmailConfirmed%% "
=%%# $
table%%% *
.%%* +
Column%%+ 1
<%%1 2
bool%%2 6
>%%6 7
(%%7 8
type%%8 <
:%%< =
$str%%> C
,%%C D
nullable%%E M
:%%M N
false%%O T
)%%T U
,%%U V
PasswordHash&&  
=&&! "
table&&# (
.&&( )
Column&&) /
<&&/ 0
string&&0 6
>&&6 7
(&&7 8
type&&8 <
:&&< =
$str&&> M
,&&M N
nullable&&O W
:&&W X
true&&Y ]
)&&] ^
,&&^ _
SecurityStamp'' !
=''" #
table''$ )
.'') *
Column''* 0
<''0 1
string''1 7
>''7 8
(''8 9
type''9 =
:''= >
$str''? N
,''N O
nullable''P X
:''X Y
true''Z ^
)''^ _
,''_ `
ConcurrencyStamp(( $
=((% &
table((' ,
.((, -
Column((- 3
<((3 4
string((4 :
>((: ;
(((; <
type((< @
:((@ A
$str((B Q
,((Q R
nullable((S [
:(([ \
true((] a
)((a b
,((b c
PhoneNumber)) 
=))  !
table))" '
.))' (
Column))( .
<)). /
string))/ 5
>))5 6
())6 7
type))7 ;
:)); <
$str))= L
,))L M
nullable))N V
:))V W
true))X \
)))\ ]
,))] ^ 
PhoneNumberConfirmed** (
=**) *
table**+ 0
.**0 1
Column**1 7
<**7 8
bool**8 <
>**< =
(**= >
type**> B
:**B C
$str**D I
,**I J
nullable**K S
:**S T
false**U Z
)**Z [
,**[ \
TwoFactorEnabled++ $
=++% &
table++' ,
.++, -
Column++- 3
<++3 4
bool++4 8
>++8 9
(++9 :
type++: >
:++> ?
$str++@ E
,++E F
nullable++G O
:++O P
false++Q V
)++V W
,++W X

LockoutEnd,, 
=,,  
table,,! &
.,,& '
Column,,' -
<,,- .
DateTimeOffset,,. <
>,,< =
(,,= >
type,,> B
:,,B C
$str,,D T
,,,T U
nullable,,V ^
:,,^ _
true,,` d
),,d e
,,,e f
LockoutEnabled-- "
=--# $
table--% *
.--* +
Column--+ 1
<--1 2
bool--2 6
>--6 7
(--7 8
type--8 <
:--< =
$str--> C
,--C D
nullable--E M
:--M N
false--O T
)--T U
,--U V
AccessFailedCount.. %
=..& '
table..( -
...- .
Column... 4
<..4 5
int..5 8
>..8 9
(..9 :
type..: >
:..> ?
$str..@ E
,..E F
nullable..G O
:..O P
false..Q V
)..V W
}// 
,// 
constraints00 
:00 
table00 "
=>00# %
{11 
table22 
.22 

PrimaryKey22 $
(22$ %
$str22% 5
,225 6
x227 8
=>229 ;
x22< =
.22= >
Id22> @
)22@ A
;22A B
}33 
)33 
;33 
migrationBuilder55 
.55 
CreateTable55 (
(55( )
name66 
:66 
$str66 (
,66( )
columns77 
:77 
table77 
=>77 !
new77" %
{88 
Id99 
=99 
table99 
.99 
Column99 %
<99% &
int99& )
>99) *
(99* +
type99+ /
:99/ 0
$str991 6
,996 7
nullable998 @
:99@ A
false99B G
)99G H
.:: 

Annotation:: #
(::# $
$str::$ 8
,::8 9
$str::: @
)::@ A
,::A B
RoleId;; 
=;; 
table;; "
.;;" #
Column;;# )
<;;) *
Guid;;* .
>;;. /
(;;/ 0
type;;0 4
:;;4 5
$str;;6 H
,;;H I
nullable;;J R
:;;R S
false;;T Y
);;Y Z
,;;Z [
	ClaimType<< 
=<< 
table<<  %
.<<% &
Column<<& ,
<<<, -
string<<- 3
><<3 4
(<<4 5
type<<5 9
:<<9 :
$str<<; J
,<<J K
nullable<<L T
:<<T U
true<<V Z
)<<Z [
,<<[ \

ClaimValue== 
===  
table==! &
.==& '
Column==' -
<==- .
string==. 4
>==4 5
(==5 6
type==6 :
:==: ;
$str==< K
,==K L
nullable==M U
:==U V
true==W [
)==[ \
}>> 
,>> 
constraints?? 
:?? 
table?? "
=>??# %
{@@ 
tableAA 
.AA 

PrimaryKeyAA $
(AA$ %
$strAA% :
,AA: ;
xAA< =
=>AA> @
xAAA B
.AAB C
IdAAC E
)AAE F
;AAF G
tableBB 
.BB 

ForeignKeyBB $
(BB$ %
nameCC 
:CC 
$strCC F
,CCF G
columnDD 
:DD 
xDD  !
=>DD" $
xDD% &
.DD& '
RoleIdDD' -
,DD- .
principalTableEE &
:EE& '
$strEE( 5
,EE5 6
principalColumnFF '
:FF' (
$strFF) -
,FF- .
onDeleteGG  
:GG  !
ReferentialActionGG" 3
.GG3 4
CascadeGG4 ;
)GG; <
;GG< =
}HH 
)HH 
;HH 
migrationBuilderJJ 
.JJ 
CreateTableJJ (
(JJ( )
nameKK 
:KK 
$strKK (
,KK( )
columnsLL 
:LL 
tableLL 
=>LL !
newLL" %
{MM 
IdNN 
=NN 
tableNN 
.NN 
ColumnNN %
<NN% &
intNN& )
>NN) *
(NN* +
typeNN+ /
:NN/ 0
$strNN1 6
,NN6 7
nullableNN8 @
:NN@ A
falseNNB G
)NNG H
.OO 

AnnotationOO #
(OO# $
$strOO$ 8
,OO8 9
$strOO: @
)OO@ A
,OOA B
UserIdPP 
=PP 
tablePP "
.PP" #
ColumnPP# )
<PP) *
GuidPP* .
>PP. /
(PP/ 0
typePP0 4
:PP4 5
$strPP6 H
,PPH I
nullablePPJ R
:PPR S
falsePPT Y
)PPY Z
,PPZ [
	ClaimTypeQQ 
=QQ 
tableQQ  %
.QQ% &
ColumnQQ& ,
<QQ, -
stringQQ- 3
>QQ3 4
(QQ4 5
typeQQ5 9
:QQ9 :
$strQQ; J
,QQJ K
nullableQQL T
:QQT U
trueQQV Z
)QQZ [
,QQ[ \

ClaimValueRR 
=RR  
tableRR! &
.RR& '
ColumnRR' -
<RR- .
stringRR. 4
>RR4 5
(RR5 6
typeRR6 :
:RR: ;
$strRR< K
,RRK L
nullableRRM U
:RRU V
trueRRW [
)RR[ \
}SS 
,SS 
constraintsTT 
:TT 
tableTT "
=>TT# %
{UU 
tableVV 
.VV 

PrimaryKeyVV $
(VV$ %
$strVV% :
,VV: ;
xVV< =
=>VV> @
xVVA B
.VVB C
IdVVC E
)VVE F
;VVF G
tableWW 
.WW 

ForeignKeyWW $
(WW$ %
nameXX 
:XX 
$strXX F
,XXF G
columnYY 
:YY 
xYY  !
=>YY" $
xYY% &
.YY& '
UserIdYY' -
,YY- .
principalTableZZ &
:ZZ& '
$strZZ( 5
,ZZ5 6
principalColumn[[ '
:[[' (
$str[[) -
,[[- .
onDelete\\  
:\\  !
ReferentialAction\\" 3
.\\3 4
Cascade\\4 ;
)\\; <
;\\< =
}]] 
)]] 
;]] 
migrationBuilder__ 
.__ 
CreateTable__ (
(__( )
name`` 
:`` 
$str`` (
,``( )
columnsaa 
:aa 
tableaa 
=>aa !
newaa" %
{bb 
LoginProvidercc !
=cc" #
tablecc$ )
.cc) *
Columncc* 0
<cc0 1
stringcc1 7
>cc7 8
(cc8 9
typecc9 =
:cc= >
$strcc? N
,ccN O
nullableccP X
:ccX Y
falseccZ _
)cc_ `
,cc` a
ProviderKeydd 
=dd  !
tabledd" '
.dd' (
Columndd( .
<dd. /
stringdd/ 5
>dd5 6
(dd6 7
typedd7 ;
:dd; <
$strdd= L
,ddL M
nullableddN V
:ddV W
falseddX ]
)dd] ^
,dd^ _
ProviderDisplayNameee '
=ee( )
tableee* /
.ee/ 0
Columnee0 6
<ee6 7
stringee7 =
>ee= >
(ee> ?
typeee? C
:eeC D
$streeE T
,eeT U
nullableeeV ^
:ee^ _
trueee` d
)eed e
,eee f
UserIdff 
=ff 
tableff "
.ff" #
Columnff# )
<ff) *
Guidff* .
>ff. /
(ff/ 0
typeff0 4
:ff4 5
$strff6 H
,ffH I
nullableffJ R
:ffR S
falseffT Y
)ffY Z
}gg 
,gg 
constraintshh 
:hh 
tablehh "
=>hh# %
{ii 
tablejj 
.jj 

PrimaryKeyjj $
(jj$ %
$strjj% :
,jj: ;
xjj< =
=>jj> @
newjjA D
{jjE F
xjjG H
.jjH I
LoginProviderjjI V
,jjV W
xjjX Y
.jjY Z
ProviderKeyjjZ e
}jjf g
)jjg h
;jjh i
tablekk 
.kk 

ForeignKeykk $
(kk$ %
namell 
:ll 
$strll F
,llF G
columnmm 
:mm 
xmm  !
=>mm" $
xmm% &
.mm& '
UserIdmm' -
,mm- .
principalTablenn &
:nn& '
$strnn( 5
,nn5 6
principalColumnoo '
:oo' (
$stroo) -
,oo- .
onDeletepp  
:pp  !
ReferentialActionpp" 3
.pp3 4
Cascadepp4 ;
)pp; <
;pp< =
}qq 
)qq 
;qq 
migrationBuilderss 
.ss 
CreateTabless (
(ss( )
namett 
:tt 
$strtt '
,tt' (
columnsuu 
:uu 
tableuu 
=>uu !
newuu" %
{vv 
UserIdww 
=ww 
tableww "
.ww" #
Columnww# )
<ww) *
Guidww* .
>ww. /
(ww/ 0
typeww0 4
:ww4 5
$strww6 H
,wwH I
nullablewwJ R
:wwR S
falsewwT Y
)wwY Z
,wwZ [
RoleIdxx 
=xx 
tablexx "
.xx" #
Columnxx# )
<xx) *
Guidxx* .
>xx. /
(xx/ 0
typexx0 4
:xx4 5
$strxx6 H
,xxH I
nullablexxJ R
:xxR S
falsexxT Y
)xxY Z
}yy 
,yy 
constraintszz 
:zz 
tablezz "
=>zz# %
{{{ 
table|| 
.|| 

PrimaryKey|| $
(||$ %
$str||% 9
,||9 :
x||; <
=>||= ?
new||@ C
{||D E
x||F G
.||G H
UserId||H N
,||N O
x||P Q
.||Q R
RoleId||R X
}||Y Z
)||Z [
;||[ \
table}} 
.}} 

ForeignKey}} $
(}}$ %
name~~ 
:~~ 
$str~~ E
,~~E F
column 
: 
x  !
=>" $
x% &
.& '
RoleId' -
,- .
principalTable
ÄÄ &
:
ÄÄ& '
$str
ÄÄ( 5
,
ÄÄ5 6
principalColumn
ÅÅ '
:
ÅÅ' (
$str
ÅÅ) -
,
ÅÅ- .
onDelete
ÇÇ  
:
ÇÇ  !
ReferentialAction
ÇÇ" 3
.
ÇÇ3 4
Cascade
ÇÇ4 ;
)
ÇÇ; <
;
ÇÇ< =
table
ÉÉ 
.
ÉÉ 

ForeignKey
ÉÉ $
(
ÉÉ$ %
name
ÑÑ 
:
ÑÑ 
$str
ÑÑ E
,
ÑÑE F
column
ÖÖ 
:
ÖÖ 
x
ÖÖ  !
=>
ÖÖ" $
x
ÖÖ% &
.
ÖÖ& '
UserId
ÖÖ' -
,
ÖÖ- .
principalTable
ÜÜ &
:
ÜÜ& '
$str
ÜÜ( 5
,
ÜÜ5 6
principalColumn
áá '
:
áá' (
$str
áá) -
,
áá- .
onDelete
àà  
:
àà  !
ReferentialAction
àà" 3
.
àà3 4
Cascade
àà4 ;
)
àà; <
;
àà< =
}
ââ 
)
ââ 
;
ââ 
migrationBuilder
ãã 
.
ãã 
CreateTable
ãã (
(
ãã( )
name
åå 
:
åå 
$str
åå (
,
åå( )
columns
çç 
:
çç 
table
çç 
=>
çç !
new
çç" %
{
éé 
UserId
èè 
=
èè 
table
èè "
.
èè" #
Column
èè# )
<
èè) *
Guid
èè* .
>
èè. /
(
èè/ 0
type
èè0 4
:
èè4 5
$str
èè6 H
,
èèH I
nullable
èèJ R
:
èèR S
false
èèT Y
)
èèY Z
,
èèZ [
LoginProvider
êê !
=
êê" #
table
êê$ )
.
êê) *
Column
êê* 0
<
êê0 1
string
êê1 7
>
êê7 8
(
êê8 9
type
êê9 =
:
êê= >
$str
êê? N
,
êêN O
nullable
êêP X
:
êêX Y
false
êêZ _
)
êê_ `
,
êê` a
Name
ëë 
=
ëë 
table
ëë  
.
ëë  !
Column
ëë! '
<
ëë' (
string
ëë( .
>
ëë. /
(
ëë/ 0
type
ëë0 4
:
ëë4 5
$str
ëë6 E
,
ëëE F
nullable
ëëG O
:
ëëO P
false
ëëQ V
)
ëëV W
,
ëëW X
Value
íí 
=
íí 
table
íí !
.
íí! "
Column
íí" (
<
íí( )
string
íí) /
>
íí/ 0
(
íí0 1
type
íí1 5
:
íí5 6
$str
íí7 F
,
ííF G
nullable
ííH P
:
ííP Q
true
ííR V
)
ííV W
}
ìì 
,
ìì 
constraints
îî 
:
îî 
table
îî "
=>
îî# %
{
ïï 
table
ññ 
.
ññ 

PrimaryKey
ññ $
(
ññ$ %
$str
ññ% :
,
ññ: ;
x
ññ< =
=>
ññ> @
new
ññA D
{
ññE F
x
ññG H
.
ññH I
UserId
ññI O
,
ññO P
x
ññQ R
.
ññR S
LoginProvider
ññS `
,
ññ` a
x
ññb c
.
ññc d
Name
ññd h
}
ññi j
)
ññj k
;
ññk l
table
óó 
.
óó 

ForeignKey
óó $
(
óó$ %
name
òò 
:
òò 
$str
òò F
,
òòF G
column
ôô 
:
ôô 
x
ôô  !
=>
ôô" $
x
ôô% &
.
ôô& '
UserId
ôô' -
,
ôô- .
principalTable
öö &
:
öö& '
$str
öö( 5
,
öö5 6
principalColumn
õõ '
:
õõ' (
$str
õõ) -
,
õõ- .
onDelete
úú  
:
úú  !
ReferentialAction
úú" 3
.
úú3 4
Cascade
úú4 ;
)
úú; <
;
úú< =
}
ùù 
)
ùù 
;
ùù 
migrationBuilder
üü 
.
üü 
CreateIndex
üü (
(
üü( )
name
†† 
:
†† 
$str
†† 2
,
††2 3
table
°° 
:
°° 
$str
°° )
,
°°) *
column
¢¢ 
:
¢¢ 
$str
¢¢  
)
¢¢  !
;
¢¢! "
migrationBuilder
§§ 
.
§§ 
CreateIndex
§§ (
(
§§( )
name
•• 
:
•• 
$str
•• %
,
••% &
table
¶¶ 
:
¶¶ 
$str
¶¶ $
,
¶¶$ %
column
ßß 
:
ßß 
$str
ßß (
,
ßß( )
unique
®® 
:
®® 
true
®® 
,
®® 
filter
©© 
:
©© 
$str
©© 6
)
©©6 7
;
©©7 8
migrationBuilder
´´ 
.
´´ 
CreateIndex
´´ (
(
´´( )
name
¨¨ 
:
¨¨ 
$str
¨¨ 2
,
¨¨2 3
table
≠≠ 
:
≠≠ 
$str
≠≠ )
,
≠≠) *
column
ÆÆ 
:
ÆÆ 
$str
ÆÆ  
)
ÆÆ  !
;
ÆÆ! "
migrationBuilder
∞∞ 
.
∞∞ 
CreateIndex
∞∞ (
(
∞∞( )
name
±± 
:
±± 
$str
±± 2
,
±±2 3
table
≤≤ 
:
≤≤ 
$str
≤≤ )
,
≤≤) *
column
≥≥ 
:
≥≥ 
$str
≥≥  
)
≥≥  !
;
≥≥! "
migrationBuilder
µµ 
.
µµ 
CreateIndex
µµ (
(
µµ( )
name
∂∂ 
:
∂∂ 
$str
∂∂ 1
,
∂∂1 2
table
∑∑ 
:
∑∑ 
$str
∑∑ (
,
∑∑( )
column
∏∏ 
:
∏∏ 
$str
∏∏  
)
∏∏  !
;
∏∏! "
migrationBuilder
∫∫ 
.
∫∫ 
CreateIndex
∫∫ (
(
∫∫( )
name
ªª 
:
ªª 
$str
ªª "
,
ªª" #
table
ºº 
:
ºº 
$str
ºº $
,
ºº$ %
column
ΩΩ 
:
ΩΩ 
$str
ΩΩ )
)
ΩΩ) *
;
ΩΩ* +
migrationBuilder
øø 
.
øø 
CreateIndex
øø (
(
øø( )
name
¿¿ 
:
¿¿ 
$str
¿¿ %
,
¿¿% &
table
¡¡ 
:
¡¡ 
$str
¡¡ $
,
¡¡$ %
column
¬¬ 
:
¬¬ 
$str
¬¬ ,
,
¬¬, -
unique
√√ 
:
√√ 
true
√√ 
,
√√ 
filter
ƒƒ 
:
ƒƒ 
$str
ƒƒ :
)
ƒƒ: ;
;
ƒƒ; <
}
≈≈ 	
	protected
»» 
override
»» 
void
»» 
Down
»»  $
(
»»$ %
MigrationBuilder
»»% 5
migrationBuilder
»»6 F
)
»»F G
{
…… 	
migrationBuilder
   
.
   
	DropTable
   &
(
  & '
name
ÀÀ 
:
ÀÀ 
$str
ÀÀ (
)
ÀÀ( )
;
ÀÀ) *
migrationBuilder
ÕÕ 
.
ÕÕ 
	DropTable
ÕÕ &
(
ÕÕ& '
name
ŒŒ 
:
ŒŒ 
$str
ŒŒ (
)
ŒŒ( )
;
ŒŒ) *
migrationBuilder
–– 
.
–– 
	DropTable
–– &
(
––& '
name
—— 
:
—— 
$str
—— (
)
——( )
;
——) *
migrationBuilder
”” 
.
”” 
	DropTable
”” &
(
””& '
name
‘‘ 
:
‘‘ 
$str
‘‘ '
)
‘‘' (
;
‘‘( )
migrationBuilder
÷÷ 
.
÷÷ 
	DropTable
÷÷ &
(
÷÷& '
name
◊◊ 
:
◊◊ 
$str
◊◊ (
)
◊◊( )
;
◊◊) *
migrationBuilder
ŸŸ 
.
ŸŸ 
	DropTable
ŸŸ &
(
ŸŸ& '
name
⁄⁄ 
:
⁄⁄ 
$str
⁄⁄ #
)
⁄⁄# $
;
⁄⁄$ %
migrationBuilder
‹‹ 
.
‹‹ 
	DropTable
‹‹ &
(
‹‹& '
name
›› 
:
›› 
$str
›› #
)
››# $
;
››$ %
}
ﬁﬁ 	
}
ﬂﬂ 
}‡‡ è
_/Users/bachviet/Documents/Personal/dotnet/cShop/src/Services/IdentityServer/Data/Domain/User.cs
	namespace 	
IdentityServer
 
. 
Data 
. 
Domain $
;$ %
public 
class 
User 
: 
IdentityUser  
<  !
Guid! %
>% &
{ 
} ¶
c/Users/bachviet/Documents/Personal/dotnet/cShop/src/Services/IdentityServer/CustomProfileService.cs
	namespace 	
IdentityServer
 
; 
public		 
class		  
CustomProfileService		 !
:		" #
IProfileService		$ 3
{

 
private 
readonly 
UserManager  
<  !
User! %
>% &
_userManager' 3
;3 4
public 
 
CustomProfileService 
(  
UserManager  +
<+ ,
User, 0
>0 1
userManager2 =
)= >
{ 
_userManager 
= 
userManager "
;" #
} 
public 

async 
Task 
GetProfileDataAsync )
() *%
ProfileDataRequestContext* C
contextD K
)K L
{ 
var 
user 
= 
await 
_userManager %
.% &
GetUserAsync& 2
(2 3
context3 :
.: ;
Subject; B
)B C
;C D
if 

( 
user 
is 
null 
) 
throw 
new  #
	Exception$ -
(- .
$". 0
$str0 M
{M N
contextN U
.U V
SubjectV ]
}] ^
$str^ `
"` a
)a b
;b c
var 
claims 
= 
new 
List 
< 
Claim #
># $
($ %
)% &
{ 	
new 
Claim 
( 

ClaimTypes  
.  !
NameIdentifier! /
,/ 0
Guid1 5
.5 6
NewGuid6 =
(= >
)> ?
.? @
ToString@ H
(H I
)I J
)J K
} 	
;	 

context 
. 
IssuedClaims 
. 
AddRange %
(% &
claims& ,
), -
;- .
} 
public!! 

Task!! 
IsActiveAsync!! 
(!! 
IsActiveContext!! -
context!!. 5
)!!5 6
=>!!7 9
Task!!: >
.!!> ?
CompletedTask!!? L
;!!L M
}"" ¬
U/Users/bachviet/Documents/Personal/dotnet/cShop/src/Services/IdentityServer/Config.cs
	namespace 	
IdentityServer
 
; 
public 
static 
class 
Config 
{ 
public 

static 
IEnumerable 
< 
IdentityResource .
>. /
IdentityResources0 A
=>B D
new		 
IdentityResource		 
[		 
]		 
{

 	
new 
IdentityResources !
.! "
OpenId" (
(( )
)) *
} 	
;	 

public 

static 
IEnumerable 
< 
ApiScope &
>& '
	ApiScopes( 1
=>2 4
new 
ApiScope 
[ 
] 
{ 	
new 
ApiScope 
( 
name 
: 
$str $
,$ %
displayName& 1
:1 2
$str3 >
)> ?
} 	
;	 

public 

static 
IEnumerable 
< 
Client $
>$ %
Clients& -
=>. 0
new 
Client 
[ 
] 
{ 	
new 
Client 
{ 
ClientId 
= 
$str #
,# $
AllowedGrantTypes !
=" #

GrantTypes$ .
.. /!
ResourceOwnerPassword/ D
,D E
ClientSecrets 
= 
{   
new!! 
Secret!! 
(!! 
$str!! '
.!!' (
Sha256!!( .
(!!. /
)!!/ 0
)!!0 1
}"" 
,"" 
AllowedScopes$$ 
=$$ 
{$$  !
$str$$" '
}$$( )
,$$) *
AllowOfflineAccess%% "
=%%# $
true%%% )
}&& 
}'' 	
;''	 

public)) 

static)) 
IEnumerable)) 
<)) 
TestUser)) &
>))& '
Users))( -
=>)). 0
new))1 4
[))4 5
]))5 6
{** 
new++ 
TestUser++ 
(++ 
)++ 
{,, 	
	SubjectId-- 
=-- 
Guid-- 
.-- 
NewGuid-- $
(--$ %
)--% &
.--& '
ToString--' /
(--/ 0
)--0 1
,--1 2
Username.. 
=.. 
$str.. 
,.. 
Password// 
=// 
$str// !
}00 	
,00	 

}11 
;11 
}22 